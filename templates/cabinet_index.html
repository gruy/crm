{% extends 'cabinet_base.html' %}

{% block header %}
<header>
  {% include '__cabinet/header.html' %}
</header>
{% endblock %}
{% block content %}
  <div class="container">
  {% if city_list %}
    <div class="row">
      <div class="col-lg-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <p class="lead remove-bottom text-center">Города</p>
          </div>
          <div class="panel-body">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>id</th>
                  <th>Название</th>
                  {% if user.type == 1 %}
                  <th>Модератор</th>
                  {% endif %}
                  <th>Количество поверхностей</th>
                  <th>Количество клиентов</th>
                </tr>
              </thead>
              <tbody>
              {% for city in city_list %}
                <tr>
                  <td> {{ city.id|default:'--' }}</td>
                  <td><a href="{% url 'city:change' city.id %}">{{ city.name|default:'--' }}</a></td>
                {% if user.type == 1 %}
                  {% if city.moderator %}
                  <td><a href="{% url 'cabinet:user-change' city.moderator.id %}">{{ city.moderator|default:'Не указан' }}</a></td>
                  {% else %}
                  <td>{{ city.moderator|default:'Не указан' }}</td>
                  {% endif %}
                {% endif %}
                  <td><a href="{% url 'city:surface-list' %}?city={{ city.id }}">{{ city.surface_count|default:'--' }}</a></td>
                  <td>{{ city.client_set.all.count|default:'--' }}</td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  {% if client_list %}
    <div class="row">
      <div class="col-lg-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <p class="lead remove-bottom text-center">Клиенты</p>
          </div>
          <div class="panel-body">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>id</th>
                  <th>Пользователь</th>
                  <th>Город</th>
                  <th>Юриическое название</th>
                  <th>Руководитель</th>
                  <th>Должность руководителя</th>
                </tr>
              </thead>
              <tbody>
              {% for client in client_list %}
                <tr>
                  <td>{{ client.id|default:'--' }}</td>
                  <td><a href="{% url 'cabinet:user-change' client.user.id %}">{{ client.user.email|default:'--' }}</a></td>
                  <td><a href="{%  url 'city:change' client.city.id %}">{{ client.city|default:'--' }}</a></td>
                  <td><a href="{% url 'client:change' client.id %}">{{ client.legal_name|default:'Не указан' }}</a></td>
                  <td>{{ client.leader|default:'Не указан' }}</td>
                  <td>{{ client.leader_function|default:'Не указано' }}</td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
  </div>
{% endblock %}
