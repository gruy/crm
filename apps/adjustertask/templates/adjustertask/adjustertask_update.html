{% extends 'cabinet_index.html' %}
{% block extra_js %}
  <script src="http://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
  {% include 'adjustertask/__include/map-task.html' %}
{% endblock %}
{% block content %}
  <div class="container">
    <div class="col-lg-12">
      <div class="panel panel-default">
        <div class="panel-heading">
          <p class="lead text-center remove-bottom">Задача для монтажника на {{ object.date }}</p>
        </div>
        <div class="panel-body">
          <div class="col-lg-12">
            <div class="add-bottom panel panel-success">
              <div class="panel-heading js-map-task-heading">
                Карта монтажных работ <span class="caret"></span>
              </div>
              <div class="panel-body js-map-task-body">
                <div id="tasksMap" style="height: 500px;"></div>
                <div class="clearfix"></div>
              </div>
            </div>
          </div>
          <div class="col-lg-12">
          {% if error %}
            <div class="alert alert-danger">
              {{ error }}
            </div>
          {%  endif %}
          {% if success %}
            <div class="alert alert-success">
              {{ success }}
            </div>
          {% endif %}

            <form action="." role="form" class="add-bottom" id="js-adjuster-client_task-update-form" method="post" data-client-ajax-url="{% url 'adjustertask:client-ajax' %}">
              {% csrf_token %}
              {% load widget_tweaks %}
              <div class="col-lg-6">
                <div class="col-lg-12">
                  <p class="lead">Информация по задаче</p>
                </div>
                <div class="form-group">
                  <div class="col-lg-5">
                    {{ adjuster_task_form.adjuster.label_tag }}
                  </div>
                  <div class="col-lg-7">
                    {% if user.type == 4 %}
                    {{ adjuster_task_form.adjuster|attr:'disabled:disabled' }}
                    {% else %}
                    {{ adjuster_task_form.adjuster }}
                    {% endif %}
                  </div>
                  {{ adjuster_task_form.adjuster.errors }}
                  <div class="clearfix"></div>
                </div>
                <div class="form-group">
                  <div class="col-lg-5">
                    {{ adjuster_task_form.type.label_tag }}
                  </div>
                  <div class="col-lg-7">
                    {% if user.type == 4 %}
                    {{ adjuster_task_form.type|attr:'disabled:disabled' }}
                    {% else %}
                    {{ adjuster_task_form.type }}
                    {% endif %}
                  </div>
                  {{ adjuster_task_form.type.errors }}
                  <div class="clearfix"></div>
                </div>
                <div class="form-group">
                  <div class="col-lg-5">
                    {{ adjuster_task_form.date.label_tag }}
                  </div>
                  <div class="col-lg-7">
                    {% if user.type == 4 %}
                    {{ adjuster_task_form.date|attr:'disabled:disabled' }}
                    {% else %}
                    {{ adjuster_task_form.date }}
                    {% endif %}
                  </div>
                  {{ adjuster_task_form.date.errors }}
                  <div class="clearfix"></div>
                </div>
              </div>
              <div class="col-lg-6">
                {{ adjuster_task_form.comment.label_tag }}
                {% if user.type == 4 %}
                {{ adjuster_task_form.comment|attr:'disabled:disabled' }}
                {% else %}
                {{ adjuster_task_form.comment }}
                {% endif %}
                {{ adjuster_task_form.comment.errors }}
              </div>
              <div class="col-lg-12">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Город</th>
                      <th>Район</th>
                      <th>Улица</th>
                      <th>Номер дома</th>
                      <th>Кол-во стендов</th>
                      <th>Номера подъездов</th>
                    </tr>
                  </thead>
                  <tbody class="js-task-surface-list">
                  {% for ats in task_surface_list %}
                    <tr {% if ats.is_closed %}class="success"{% endif %}>
                      <td>{{ ats.surface.street.city }}</td>
                      <td>{{ ats.surface.street.area }}</td>
                      <td>{{ ats.surface.street.name }}</td>
                      <td>{{ ats.surface.house_number }}</td>
                      <td>{{ ats.adjustertasksurfaceporch_set.count }}</td>
                      <td>
                        {% for atsp in ats.adjustertasksurfaceporch_set.all %}
                          {{ atsp.porch.number }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                      </td>
                    </tr>
                  {% empty %}
                    <tr>
                      <td colspan="6">
                        <p class="alert alert-info">Адресов не найдено</p>
                      </td>
                    </tr>
                  {% endfor %}
                  </tbody>
                </table>
                {% include '__includes/pagination.html' with page_obj=task_surface_list %}
              </div>
              <div class="clearfix"></div>
              <button type="submit" class="btn btn-default">Сохранить</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}